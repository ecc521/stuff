<script src="https://ecc521.github.io/librarys/indexeddb.js"></script>

<script>

(async function(){
  let whenmessaged = new Promise(function(resolve, reject){
    navigator.serviceWorker.addEventListener('message', function(event){
        resolve()
    });
  })

  await navigator.serviceWorker.register("/stuff/manifestcreator/sw.js")

  await whenmessaged;
  
  let obj = {
    name:"bob",
    short_name:"b"
  }

  let db = await lib.loaddb("manifest")
  await db.set("json", JSON.stringify(obj))
  
 let response = await fetch("https://ecc521.github.io/stuff/manifestcreator/manifest?")
 console.log(response)
 window.resp = response
  
 let txt = await resp.text()
 let manifest = await JSON.parse(txt)
 console.log(manifest)
  
}())

</script>
